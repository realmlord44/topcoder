import pprint
class ShopPositions(object):
    def helper(self, a, b, i):
        if '%i:%i:%i' % (a, b, i) not in self.access:
            self.access['%i:%i:%i' % (a, b, i)] = 1
        else:
            self.access['%i:%i:%i' % (a, b, i)] += 1
        if self.profits[a][b][i] == 0:
            if i + 2 == self.n:
                self.profits[a][b][i] = b * self.c[(i+1)*3*self.m+a+b-1]
            else:
                for c in range(self.m+1):
                    thisProfit = 0
                    thisProfit = b * self.c[(i+1)*3*self.m+a+b+c-1] + self.helper(b, c, i+1)
                    if thisProfit > self.profits[a][b][i]:
                        self.profits[a][b][i] = thisProfit
                        self.futureStands[i] = c
        return self.profits[a][b][i]

    def maxProfit(self, n, m, c):
        self.access = {}
        self.profits = [[[0 for i in range(n)] for j in range(m+1)] for k in range(m+1)]
        self.n = n
        self.m = m
        self.c = c
        self.numStands = [0 for i in range(n)]
        self.futureStands = [0 for i in range(n-2)]
        maxProfit = 0
        for a in range(m+1):
            for b in range(m+1):
                thisProfit = 0
                if a > 0:
                    thisProfit += a * c[a+b-1]
                if n > 1:
                    thisProfit += self.helper(a, b, 0)
                elif b > 0:
                    thisProfit = 0
                if thisProfit > maxProfit:
                    maxProfit = thisProfit
                    self.numStands[0] = a
                    self.numStands[1] = b
                    self.numStands[2:] = self.futureStands
        print self.numStands
        pprint.pprint( self.access)
        return maxProfit

a = ShopPositions()
print a.maxProfit(
19,
15,
[995, 763, 751, 748, 742, 730, 668, 667, 642, 635, 635, 502, 495, 444, 416, 406, 369, 357, 329, 314, 289, 282, 224, 224, 223, 196, 188, 184, 174, 159, 144, 125, 76, 73, 59, 48, 45, 39, 22, 22, 9, 8, 5, 4, 1, 916, 892, 870, 793, 783, 776, 687, 686, 606, 597, 576, 498, 485, 472, 453, 387, 382, 357, 346, 302, 246, 245, 207, 204, 193, 191, 167, 152, 148, 118, 110, 65, 51, 36, 35, 31, 30, 26, 26, 20, 13, 13, 10, 6, 1, 974, 923, 888, 832, 758, 733, 715, 668, 663, 654, 654, 596, 577, 574, 573, 525, 503, 460, 452, 448, 366, 311, 260, 244, 196, 180, 163, 154, 151, 146, 135, 124, 100, 90, 84, 70, 69, 54, 53, 42, 34, 28, 22, 11, 1, 995, 933, 932, 920, 776, 751, 738, 729, 637, 556, 549, 503, 468, 413, 394, 368, 367, 330, 292, 289, 281, 265, 256, 224, 197, 171, 155, 151, 145, 131, 95, 80, 68, 58, 40, 32, 28, 12, 9, 8, 6, 3, 2, 1, 1, 990, 953, 953, 943, 938, 919, 886, 861, 852, 849, 828, 804, 796, 746, 614, 611, 586, 546, 514, 471, 411, 390, 385, 381, 364, 322, 266, 186, 102, 102, 98, 81, 76, 70, 51, 33, 28, 21, 12, 11, 11, 9, 6, 3, 1, 961, 851, 836, 805, 793, 788, 718, 688, 662, 658, 655, 630, 496, 461, 411, 408, 406, 351, 329, 313, 271, 257, 228, 216, 212, 199, 169, 162, 123, 118, 75, 65, 62, 46, 43, 28, 20, 15, 14, 13, 11, 9, 9, 6, 2, 959, 957, 906, 837, 777, 641, 628, 619, 578, 570, 553, 545, 506, 505, 462, 452, 448, 428, 363, 280, 273, 233, 219, 218, 192, 180, 160, 157, 149, 142, 120, 93, 80, 76, 62, 56, 45, 45, 37, 30, 27, 12, 7, 1, 1, 989, 926, 910, 898, 834, 796, 782, 753, 682, 637, 567, 548, 542, 534, 533, 532, 509, 503, 499, 494, 430, 422, 415, 374, 358, 348, 276, 257, 245, 149, 136, 136, 123, 117, 106, 80, 59, 54, 32, 26, 24, 8, 2, 2, 2, 910, 879, 849, 836, 770, 740, 734, 681, 660, 642, 572, 494, 476, 472, 448, 397, 364, 343, 293, 286, 224, 188, 180, 178, 151, 132, 126, 124, 75, 66, 57, 56, 49, 33, 32, 28, 26, 14, 13, 7, 5, 4, 4, 3, 3, 996, 995, 966, 958, 948, 935, 916, 832, 806, 793, 753, 752, 740, 671, 641, 630, 625, 619, 594, 538, 483, 459, 448, 406, 284, 281, 243, 213, 151, 142, 128, 122, 99, 89, 60, 59, 46, 32, 30, 25, 21, 18, 13, 1, 1, 992, 992, 858, 831, 795, 787, 785, 763, 763, 761, 754, 727, 606, 559, 552, 499, 496, 460, 414, 411, 387, 349, 331, 325, 321, 275, 188, 169, 159, 124, 99, 96, 84, 65, 56, 51, 36, 25, 20, 19, 13, 10, 3, 1, 1, 980, 958, 951, 845, 840, 838, 823, 816, 804, 767, 752, 750, 635, 613, 583, 580, 541, 328, 275, 274, 256, 255, 239, 203, 196, 172, 130, 90, 73, 69, 64, 61, 51, 49, 47, 46, 44, 36, 34, 34, 21, 13, 8, 5, 3, 939, 895, 885, 834, 825, 794, 783, 736, 688, 644, 613, 539, 451, 407, 392, 376, 359, 356, 354, 333, 322, 322, 301, 285, 244, 242, 220, 189, 187, 178, 174, 135, 103, 93, 90, 84, 66, 66, 65, 61, 49, 43, 32, 31, 6, 988, 959, 938, 896, 856, 850, 791, 774, 761, 675, 662, 649, 636, 630, 495, 483, 428, 389, 369, 347, 344, 333, 330, 278, 239, 217, 212, 204, 189, 184, 175, 165, 148, 142, 129, 94, 85, 85, 20, 14, 6, 5, 4, 4, 1, 988, 932, 908, 857, 849, 837, 808, 805, 797, 786, 737, 737, 726, 720, 594, 588, 585, 568, 568, 551, 545, 532, 488, 482, 469, 447, 331, 331, 314, 305, 260, 235, 189, 179, 179, 167, 142, 73, 30, 29, 27, 16, 9, 9, 2, 1000, 817, 808, 772, 767, 709, 653, 597, 560, 542, 400, 378, 344, 330, 329, 298, 291, 243, 242, 220, 209, 189, 188, 182, 142, 141, 132, 128, 122, 97, 66, 63, 63, 54, 46, 35, 33, 32, 25, 16, 9, 5, 4, 3, 1, 881, 834, 829, 822, 788, 752, 730, 711, 683, 641, 632, 563, 538, 459, 434, 428, 345, 331, 262, 260, 192, 179, 176, 158, 145, 139, 131, 110, 80, 75, 68, 68, 67, 55, 55, 55, 35, 22, 13, 9, 8, 7, 3, 2, 1, 999, 991, 934, 882, 823, 808, 718, 541, 516, 458, 429, 404, 360, 345, 310, 288, 280, 258, 252, 202, 171, 164, 146, 87, 73, 64, 63, 61, 55, 51, 48, 41, 32, 28, 15, 14, 11, 10, 10, 8, 3, 3, 2, 1, 1, 993, 941, 847, 795, 739, 711, 678, 671, 647, 634, 592, 509, 460, 435, 435, 379, 371, 331, 299, 225, 216, 193, 152, 133, 108, 99, 98, 53, 47, 29, 18, 17, 12, 11, 11, 10, 7, 5, 4, 3, 3, 3, 3, 1, 1])
